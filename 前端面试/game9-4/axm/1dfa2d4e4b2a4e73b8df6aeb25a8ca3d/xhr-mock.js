(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e():typeof define==="function"&&define.amd?define(e):t.XHRMock=e()})(this,function(){"use strict";var t=function(){function t(){this._status=200;this._reason="OK";this._headers={};this._body=null}t.prototype.status=function(t){if(typeof t!=="undefined"){this._status=t;return this}else{return this._status}};t.prototype.reason=function(t){if(typeof t!=="undefined"){this._reason=t;return this}else{return this._reason}};t.prototype.statusText=function(t){console.warn("xhr-mock: MockResponse.statusText() has been deprecated. Use MockResponse.reason() instead.");if(typeof t!=="undefined"){return this.reason(t)}else{return this.reason()}};t.prototype.header=function(t,e){if(typeof e!=="undefined"){this._headers[t.toLowerCase()]=e;return this}else{return this._headers[t.toLowerCase()]||null}};t.prototype.headers=function(t){if(typeof t==="object"){for(var e in t){if(t.hasOwnProperty(e)){this.header(e,t[e])}}return this}else{return this._headers}};t.prototype.body=function(t){if(typeof t!=="undefined"){this._body=t;return this}else{return this._body}};return t}();function e(e){var r=e.status,n=e.reason,s=e.headers,o=e.body;var i=new t;if(r){i.status(r)}if(n){i.reason(n)}if(s){i.headers(s)}if(o){i.body(o)}return i}function r(t,r,n){var s=function(e){var n=e.method();var s=e.url().toString();if(n.toUpperCase()!==t.toUpperCase()){return false}if(r instanceof RegExp){r.lastIndex=0;return r.test(s)}return s===r};var o=function(t,r){if(s(t)){if(typeof n==="object"){return e(n)}else{return n(t,r)}}};o["match"]=function(t){return s(t)};return o}var n=function(t,e){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r]};return n(t,e)};function s(t,e){n(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){o=Object.assign||function t(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o))e[o]=r[o]}return e};return o.apply(this,arguments)};function i(t,e,r,n){return new(r||(r=Promise))(function(s,o){function i(t){try{a(n.next(t))}catch(t){o(t)}}function h(t){try{a(n["throw"](t))}catch(t){o(t)}}function a(t){t.done?s(t.value):new r(function(e){e(t.value)}).then(i,h)}a((n=n.apply(t,e||[])).next())})}function h(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i;return i={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function h(t){return function(e){return a([t,e])}}function a(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,s&&(o=i[0]&2?s["return"]:i[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;if(s=0,o)i=[i[0]&2,o.value];switch(i[0]){case 0:case 1:o=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;s=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!o||i[1]>o[0]&&i[1]<o[3])){r.label=i[1];break}if(i[0]===6&&r.label<o[1]){r.label=o[1];o=i;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(i);break}if(o[2])r.ops.pop();r.trys.pop();continue}i=e.call(t,r)}catch(t){i=[6,t];s=0}finally{n=o=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}}var a=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function u(t,e){return e={exports:{}},t(e,e.exports),e.exports}var f=u(function(t,e){(function(r){var n="object"=="object"&&e&&!e.nodeType&&e;var s="object"=="object"&&t&&!t.nodeType&&t;var o=typeof a=="object"&&a;if(o.global===o||o.window===o||o.self===o){r=o}var i,h=2147483647,u=36,f=1,l=26,p=38,c=700,d=72,y=128,m="-",v=/^xn--/,b=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-f,x=Math.floor,O=String.fromCharCode,R;function S(t){throw RangeError(E[t])}function T(t,e){var r=t.length;var n=[];while(r--){n[r]=e(t[r])}return n}function _(t,e){var r=t.split("@");var n="";if(r.length>1){n=r[0]+"@";t=r[1]}t=t.replace(g,".");var s=t.split(".");var o=T(s,e).join(".");return n+o}function q(t){var e=[],r=0,n=t.length,s,o;while(r<n){s=t.charCodeAt(r++);if(s>=55296&&s<=56319&&r<n){o=t.charCodeAt(r++);if((o&64512)==56320){e.push(((s&1023)<<10)+(o&1023)+65536)}else{e.push(s);r--}}else{e.push(s)}}return e}function N(t){return T(t,function(t){var e="";if(t>65535){t-=65536;e+=O(t>>>10&1023|55296);t=56320|t&1023}e+=O(t);return e}).join("")}function C(t){if(t-48<10){return t-22}if(t-65<26){return t-65}if(t-97<26){return t-97}return u}function j(t,e){return t+22+75*(t<26)-((e!=0)<<5)}function D(t,e,r){var n=0;t=r?x(t/c):t>>1;t+=x(t/e);for(;t>w*l>>1;n+=u){t=x(t/w)}return x(n+(w+1)*t/(t+p))}function A(t){var e=[],r=t.length,n,s=0,o=y,i=d,a,p,c,v,b,g,E,w,O;a=t.lastIndexOf(m);if(a<0){a=0}for(p=0;p<a;++p){if(t.charCodeAt(p)>=128){S("not-basic")}e.push(t.charCodeAt(p))}for(c=a>0?a+1:0;c<r;){for(v=s,b=1,g=u;;g+=u){if(c>=r){S("invalid-input")}E=C(t.charCodeAt(c++));if(E>=u||E>x((h-s)/b)){S("overflow")}s+=E*b;w=g<=i?f:g>=i+l?l:g-i;if(E<w){break}O=u-w;if(b>x(h/O)){S("overflow")}b*=O}n=e.length+1;i=D(s-v,n,v==0);if(x(s/n)>h-o){S("overflow")}o+=x(s/n);s%=n;e.splice(s++,0,o)}return N(e)}function P(t){var e,r,n,s,o,i,a,p,c,v,b,g=[],E,w,R,T;t=q(t);E=t.length;e=y;r=0;o=d;for(i=0;i<E;++i){b=t[i];if(b<128){g.push(O(b))}}n=s=g.length;if(s){g.push(m)}while(n<E){for(a=h,i=0;i<E;++i){b=t[i];if(b>=e&&b<a){a=b}}w=n+1;if(a-e>x((h-r)/w)){S("overflow")}r+=(a-e)*w;e=a;for(i=0;i<E;++i){b=t[i];if(b<e&&++r>h){S("overflow")}if(b==e){for(p=r,c=u;;c+=u){v=c<=o?f:c>=o+l?l:c-o;if(p<v){break}T=p-v;R=u-v;g.push(O(j(v+T%R,0)));p=x(T/R)}g.push(O(j(p,0)));o=D(r,w,n==s);r=0;++n}}++r;++e}return g.join("")}function U(t){return _(t,function(t){return v.test(t)?A(t.slice(4).toLowerCase()):t})}function H(t){return _(t,function(t){return b.test(t)?"xn--"+P(t):t})}i={version:"1.3.2",ucs2:{decode:q,encode:N},decode:A,encode:P,toASCII:H,toUnicode:U};if(typeof undefined=="function"&&typeof undefined.amd=="object"&&undefined.amd){undefined("punycode",function(){return i})}else if(n&&s){if(t.exports==n){s.exports=i}else{for(R in i){i.hasOwnProperty(R)&&(n[R]=i[R])}}}else{r.punycode=i}})(a)});var l={isString:function(t){return typeof t==="string"},isObject:function(t){return typeof t==="object"&&t!==null},isNull:function(t){return t===null},isNullOrUndefined:function(t){return t==null}};function p(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var c=function(t,e,r,n){e=e||"&";r=r||"=";var s={};if(typeof t!=="string"||t.length===0){return s}var o=/\+/g;t=t.split(e);var i=1e3;if(n&&typeof n.maxKeys==="number"){i=n.maxKeys}var h=t.length;if(i>0&&h>i){h=i}for(var a=0;a<h;++a){var u=t[a].replace(o,"%20"),f=u.indexOf(r),l,c,d,y;if(f>=0){l=u.substr(0,f);c=u.substr(f+1)}else{l=u;c=""}d=decodeURIComponent(l);y=decodeURIComponent(c);if(!p(s,d)){s[d]=y}else if(Array.isArray(s[d])){s[d].push(y)}else{s[d]=[s[d],y]}}return s};var d=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};var y=function(t,e,r,n){e=e||"&";r=r||"=";if(t===null){t=undefined}if(typeof t==="object"){return Object.keys(t).map(function(n){var s=encodeURIComponent(d(n))+r;if(Array.isArray(t[n])){return t[n].map(function(t){return s+encodeURIComponent(d(t))}).join(e)}else{return s+encodeURIComponent(d(t[n]))}}).join(e)}if(!n)return"";return encodeURIComponent(d(n))+r+encodeURIComponent(d(t))};var m=u(function(t,e){e.decode=e.parse=c;e.encode=e.stringify=y});var v=m.decode;var b=m.parse;var g=m.encode;var E=m.stringify;var w=k;var x=L;function O(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var R=/^([a-z0-9.+-]+:)/i;var S=/:[0-9]*$/;var T=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/;var _=["<",">",'"',"`"," ","\r","\n","\t"];var q=["{","}","|","\\","^","`"].concat(_);var N=["'"].concat(q);var C=["%","/","?",";","#"].concat(N);var j=["/","?","#"];var D=255;var A=/^[+a-z0-9A-Z_-]{0,63}$/;var P=/^([+a-z0-9A-Z_-]{0,63})(.*)$/;var U={javascript:true,"javascript:":true};var H={javascript:true,"javascript:":true};var I={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true};function k(t,e,r){if(t&&l.isObject(t)&&t instanceof O)return t;var n=new O;n.parse(t,e,r);return n}O.prototype.parse=function(t,e,r){if(!l.isString(t)){throw new TypeError("Parameter 'url' must be a string, not "+typeof t)}var n=t.indexOf("?"),s=n!==-1&&n<t.indexOf("#")?"?":"#",o=t.split(s),i=/\\/g;o[0]=o[0].replace(i,"/");t=o.join(s);var h=t;h=h.trim();if(!r&&t.split("#").length===1){var a=T.exec(h);if(a){this.path=h;this.href=h;this.pathname=a[1];if(a[2]){this.search=a[2];if(e){this.query=m.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(e){this.search="";this.query={}}return this}}var u=R.exec(h);if(u){u=u[0];var p=u.toLowerCase();this.protocol=p;h=h.substr(u.length)}if(r||u||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var c=h.substr(0,2)==="//";if(c&&!(u&&H[u])){h=h.substr(2);this.slashes=true}}if(!H[u]&&(c||u&&!I[u])){var d=-1;for(var y=0;y<j.length;y++){var v=h.indexOf(j[y]);if(v!==-1&&(d===-1||v<d))d=v}var b,g;if(d===-1){g=h.lastIndexOf("@")}else{g=h.lastIndexOf("@",d)}if(g!==-1){b=h.slice(0,g);h=h.slice(g+1);this.auth=decodeURIComponent(b)}d=-1;for(var y=0;y<C.length;y++){var v=h.indexOf(C[y]);if(v!==-1&&(d===-1||v<d))d=v}if(d===-1)d=h.length;this.host=h.slice(0,d);h=h.slice(d);this.parseHost();this.hostname=this.hostname||"";var E=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!E){var w=this.hostname.split(/\./);for(var y=0,x=w.length;y<x;y++){var O=w[y];if(!O)continue;if(!O.match(A)){var S="";for(var _=0,q=O.length;_<q;_++){if(O.charCodeAt(_)>127){S+="x"}else{S+=O[_]}}if(!S.match(A)){var k=w.slice(0,y);var L=w.slice(y+1);var M=O.match(P);if(M){k.push(M[1]);L.unshift(M[2])}if(L.length){h="/"+L.join(".")+h}this.hostname=k.join(".");break}}}}if(this.hostname.length>D){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!E){this.hostname=f.toASCII(this.hostname)}var X=this.port?":"+this.port:"";var G=this.hostname||"";this.host=G+X;this.href+=this.host;if(E){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(h[0]!=="/"){h="/"+h}}}if(!U[p]){for(var y=0,x=N.length;y<x;y++){var B=N[y];if(h.indexOf(B)===-1)continue;var F=encodeURIComponent(B);if(F===B){F=escape(B)}h=h.split(B).join(F)}}var V=h.indexOf("#");if(V!==-1){this.hash=h.substr(V);h=h.slice(0,V)}var K=h.indexOf("?");if(K!==-1){this.search=h.substr(K);this.query=h.substr(K+1);if(e){this.query=m.parse(this.query)}h=h.slice(0,K)}else if(e){this.search="";this.query={}}if(h)this.pathname=h;if(I[p]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var X=this.pathname||"";var J=this.search||"";this.path=X+J}this.href=this.format();return this};function L(t){if(l.isString(t))t=k(t);if(!(t instanceof O))return O.prototype.format.call(t);return t.format()}O.prototype.format=function(){var t=this.auth||"";if(t){t=encodeURIComponent(t);t=t.replace(/%3A/i,":");t+="@"}var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",s=false,o="";if(this.host){s=t+this.host}else if(this.hostname){s=t+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&l.isObject(this.query)&&Object.keys(this.query).length){o=m.stringify(this.query)}var i=this.search||o&&"?"+o||"";if(e&&e.substr(-1)!==":")e+=":";if(this.slashes||(!e||I[e])&&s!==false){s="//"+(s||"");if(r&&r.charAt(0)!=="/")r="/"+r}else if(!s){s=""}if(n&&n.charAt(0)!=="#")n="#"+n;if(i&&i.charAt(0)!=="?")i="?"+i;r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)});i=i.replace("#","%23");return e+s+r+i+n};O.prototype.resolve=function(t){return this.resolveObject(k(t,false,true)).format()};O.prototype.resolveObject=function(t){if(l.isString(t)){var e=new O;e.parse(t,false,true);t=e}var r=new O;var n=Object.keys(this);for(var s=0;s<n.length;s++){var o=n[s];r[o]=this[o]}r.hash=t.hash;if(t.href===""){r.href=r.format();return r}if(t.slashes&&!t.protocol){var i=Object.keys(t);for(var h=0;h<i.length;h++){var a=i[h];if(a!=="protocol")r[a]=t[a]}if(I[r.protocol]&&r.hostname&&!r.pathname){r.path=r.pathname="/"}r.href=r.format();return r}if(t.protocol&&t.protocol!==r.protocol){if(!I[t.protocol]){var u=Object.keys(t);for(var f=0;f<u.length;f++){var p=u[f];r[p]=t[p]}r.href=r.format();return r}r.protocol=t.protocol;if(!t.host&&!H[t.protocol]){var c=(t.pathname||"").split("/");while(c.length&&!(t.host=c.shift()));if(!t.host)t.host="";if(!t.hostname)t.hostname="";if(c[0]!=="")c.unshift("");if(c.length<2)c.unshift("");r.pathname=c.join("/")}else{r.pathname=t.pathname}r.search=t.search;r.query=t.query;r.host=t.host||"";r.auth=t.auth;r.hostname=t.hostname||t.host;r.port=t.port;if(r.pathname||r.search){var d=r.pathname||"";var y=r.search||"";r.path=d+y}r.slashes=r.slashes||t.slashes;r.href=r.format();return r}var m=r.pathname&&r.pathname.charAt(0)==="/",v=t.host||t.pathname&&t.pathname.charAt(0)==="/",b=v||m||r.host&&t.pathname,g=b,E=r.pathname&&r.pathname.split("/")||[],c=t.pathname&&t.pathname.split("/")||[],w=r.protocol&&!I[r.protocol];if(w){r.hostname="";r.port=null;if(r.host){if(E[0]==="")E[0]=r.host;else E.unshift(r.host)}r.host="";if(t.protocol){t.hostname=null;t.port=null;if(t.host){if(c[0]==="")c[0]=t.host;else c.unshift(t.host)}t.host=null}b=b&&(c[0]===""||E[0]==="")}if(v){r.host=t.host||t.host===""?t.host:r.host;r.hostname=t.hostname||t.hostname===""?t.hostname:r.hostname;r.search=t.search;r.query=t.query;E=c}else if(c.length){if(!E)E=[];E.pop();E=E.concat(c);r.search=t.search;r.query=t.query}else if(!l.isNullOrUndefined(t.search)){if(w){r.hostname=r.host=E.shift();var x=r.host&&r.host.indexOf("@")>0?r.host.split("@"):false;if(x){r.auth=x.shift();r.host=r.hostname=x.shift()}}r.search=t.search;r.query=t.query;if(!l.isNull(r.pathname)||!l.isNull(r.search)){r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")}r.href=r.format();return r}if(!E.length){r.pathname=null;if(r.search){r.path="/"+r.search}else{r.path=null}r.href=r.format();return r}var R=E.slice(-1)[0];var S=(r.host||t.host||E.length>1)&&(R==="."||R==="..")||R==="";var T=0;for(var _=E.length;_>=0;_--){R=E[_];if(R==="."){E.splice(_,1)}else if(R===".."){E.splice(_,1);T++}else if(T){E.splice(_,1);T--}}if(!b&&!g){for(;T--;T){E.unshift("..")}}if(b&&E[0]!==""&&(!E[0]||E[0].charAt(0)!=="/")){E.unshift("")}if(S&&E.join("/").substr(-1)!=="/"){E.push("")}var q=E[0]===""||E[0]&&E[0].charAt(0)==="/";if(w){r.hostname=r.host=q?"":E.length?E.shift():"";var x=r.host&&r.host.indexOf("@")>0?r.host.split("@"):false;if(x){r.auth=x.shift();r.host=r.hostname=x.shift()}}b=b||r.host&&E.length;if(b&&!q){E.unshift("")}if(!E.length){r.pathname=null;r.path=null}else{r.pathname=E.join("/")}if(!l.isNull(r.pathname)||!l.isNull(r.search)){r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")}r.auth=t.auth||r.auth;r.slashes=r.slashes||t.slashes;r.href=r.format();return r};O.prototype.parseHost=function(){var t=this.host;var e=S.exec(t);if(e){e=e[0];if(e!==":"){this.port=e.substr(1)}t=t.substr(0,t.length-e.length)}if(t)this.hostname=t};var M=function(){function t(){}t.prototype.toString=function(){return G(this)};return t}();function X(t){var e=new M;if(!t){return e}var r=w(t,true);if(r.protocol){e.protocol=r.protocol.substr(0,r.protocol.length-1)}if(r.auth){var n=r.auth.split(":"),s=n[0],o=n[1];if(s&&o){e.username=s;e.password=o}else{e.username=s}}if(r.hostname){e.host=r.hostname}if(r.port){e.port=parseInt(r.port,10)}if(r.pathname){e.path=r.pathname}if(r.query){e.query=r.query}if(r.hash){e.hash=r.hash}return e}function G(t){var e={protocol:t.protocol,auth:t.username&&t.password?t.username+":"+t.password:t.username,hostname:t.host,port:typeof t.port==="number"?String(t.port):t.port,pathname:t.path,query:t.query,hash:t.hash};return x(e)}var B=["CONNECT","TRACE","TRACK"];var F=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];var V=function(){function t(){this._method="GET";this._url=X("");this._headers={};this._body=null}t.prototype.method=function(t){if(typeof t!=="undefined"){if(B.indexOf(t.toUpperCase())!==-1){throw new Error('xhr-mock: Method "'+t+'" is forbidden.')}if(F.indexOf(t.toUpperCase())!==-1){this._method=t.toUpperCase()}else{this._method=t}return this}else{return this._method}};t.prototype.url=function(t){if(typeof t==="string"){this._url=X(t);return this}else{return this._url}};t.prototype.header=function(t,e){if(typeof e!=="undefined"){this._headers[t.toLowerCase()]=e;return this}else{return this._headers[t.toLowerCase()]||null}};t.prototype.headers=function(t){if(typeof t==="object"){for(var e in t){if(t.hasOwnProperty(e)){this.header(e,t[e])}}return this}else{return this._headers}};t.prototype.body=function(t){if(typeof t!=="undefined"){this._body=t;return this}else{return this._body}};return t}();var K=function(){function t(t,e){this.eventPhase=0;this.type=t||"";if(e){var r=e.scoped,n=r===void 0?false:r,s=e.bubbles,o=s===void 0?false:s,i=e.cancelable,h=i===void 0?false:i;this.scoped=n;this.bubbles=o;this.cancelable=h}}t.prototype.initEvent=function(t,e,r){throw new Error};t.prototype.preventDefault=function(){throw new Error};t.prototype.stopImmediatePropagation=function(){throw new Error};t.prototype.stopPropagation=function(){throw new Error};t.prototype.deepPath=function(){throw new Error};return t}();var J=function(t){s(e,t);function e(e,r){var n=t.call(this,e,r)||this;if(r){var s=r.lengthComputable,o=s===void 0?false:s,i=r.loaded,h=i===void 0?0:i,a=r.total,u=a===void 0?0:a;n.lengthComputable=o;n.loaded=h;n.total=u}return n}e.prototype.initProgressEvent=function(t,e,r,n,s,o){throw new Error};return e}(K);var Y=function(){function t(){this.listeners={}}t.prototype.addEventListener=function(t,e,r){this.listeners=this.listeners||{};if(!e){return}if(!this.listeners[t]){this.listeners[t]=[]}if(this.listeners[t].indexOf(e)===-1){this.listeners[t].push(e)}};t.prototype.removeEventListener=function(t,e,r){this.listeners=this.listeners||{};if(!e){return}if(!this.listeners[t]){return}var n=this.listeners[t].indexOf(e);if(n!==-1){this.listeners[t].splice(n,1)}};t.prototype.dispatchEvent=function(t){var e=this;this.listeners=this.listeners||{};t.target=this;t.currentTarget=this;var r=this["on"+t.type];if(r){r.call(this,t)}if(!this.listeners[t.type]){return true}this.listeners[t.type].forEach(function(r){if(typeof r==="function"){r.call(e,t)}else{r.handleEvent.call(e,t)}});return true};return t}();var $=function(t){s(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}Object.defineProperty(e.prototype,"onabort",{get:function(){if(this.rxhr){return this.rxhr.onabort}return this._onabort},set:function(t){if(this.rxhr){this.rxhr.onabort=t}this._onabort=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"onerror",{get:function(){if(this.rxhr){return this.rxhr.onerror}return this._onerror},set:function(t){if(this.rxhr){this.rxhr.onerror=t}this._onerror=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"onload",{get:function(){if(this.rxhr){return this.rxhr.onload}return this._onload},set:function(t){if(this.rxhr){this.rxhr.onload=t}this._onload=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"onloadend",{get:function(){if(this.rxhr){return this.rxhr.onloadend}return this._onloadend},set:function(t){if(this.rxhr){this.rxhr.onloadend=t}this._onloadend=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"onloadstart",{get:function(){if(this.rxhr){return this.rxhr.onloadstart}return this._onloadstart},set:function(t){if(this.rxhr){this.rxhr.onloadstart=t}this._onloadstart=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"onprogress",{get:function(){if(this.rxhr){return this.rxhr.onprogress}return this._onprogress},set:function(t){if(this.rxhr){this.rxhr.onprogress=t}this._onprogress=t},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ontimeout",{get:function(){if(this.rxhr){return this.rxhr.ontimeout}return this._ontimeout},set:function(t){if(this.rxhr){this.rxhr.ontimeout=t}this._ontimeout=t},enumerable:true,configurable:true});return e}(Y);var z=function(t){s(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}($);var Q=function(t){s(e,t);function e(r){var n=t.call(this,r)||this;Object.setPrototypeOf(n,e.prototype);return n}return e}(Error);function Z(t){return t&&t.then!==undefined}var W=new Q("No handler returned a response for the request.");function tt(t,e,r){for(var n=0;n<t.length;++n){var s=t[n](e,r);if(s){if(Z(s)){throw new Q("A handler returned a Promise<MockResponse> for a synchronous request.")}return s}}throw W}function et(t,e,r){return t.reduce(function(t,n){return t.then(function(t){if(!t){return n(e,r)}return t})},Promise.resolve(undefined)).then(function(t){if(!t){throw W}return t})}function rt(t){var e=Object.keys(t.headers()).map(function(e){return e+": "+t.header(e)});var r=t.body()?t.body():"";return t.method()+" "+t.url()+" HTTP/1.1\n"+(e?e.join("\n")+"\n":"")+"\n"+(r?r:"")+"\n"}function nt(t,e){return t.split("\n").map(function(t,r){return Array(e+1).join(" ")+t}).join("\n")}function st(t,e,r){return"xhr-mock: "+t+"\n\n  "+nt(rt(e),2).trim()+"\n  "+(r!==undefined?"\n"+nt(r&&r.stack||r&&r.message||"Error: "+r,2):"")+"\n"}var ot=new Q("This feature hasn't been implmented yet. Please submit an Issue or Pull Request on Github.");var it=["CONNECT","TRACE","TRACK"];var ht;(function(t){t[t["UNSENT"]=0]="UNSENT";t[t["OPENED"]=1]="OPENED";t[t["HEADERS_RECEIVED"]=2]="HEADERS_RECEIVED";t[t["LOADING"]=3]="LOADING";t[t["DONE"]=4]="DONE"})(ht||(ht={}));function at(t){var e=t.header("content-length");var r=t.body();var n=false;var s=0;if(e){var o=parseInt(e,10);if(o!==NaN){n=true;s=o}}return{lengthComputable:n,loaded:r&&r.length||0,total:s}}var ut=function(e){s(r,e);function r(){var n=e!==null&&e.apply(this,arguments)||this;n.UNSENT=ht.UNSENT;n.OPENED=ht.OPENED;n.HEADERS_RECEIVED=ht.HEADERS_RECEIVED;n.LOADING=ht.LOADING;n.DONE=ht.DONE;n.withCredentials=false;n.req=new V;n.res=new t;n._timeout=0;n.isSynchronous=false;n.isSending=false;n.isUploadComplete=false;n.isAborted=false;n.isTimedOut=false;n._responseType="";n._responseURL="";n._upload=new z;n._readyState=r.UNSENT;return n}r.addHandler=function(t){this.handlers.push(t)};r.removeHandler=function(t){throw ot};r.removeAllHandlers=function(){this.handlers=[]};Object.defineProperty(r.prototype,"responseType",{get:function(){if(this.rxhr){return this.rxhr.responseType}return this._responseType},set:function(t){if(this.rxhr){this.rxhr.responseType=t;return}this._responseType=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"responseURL",{get:function(){if(this.rxhr){return this.rxhr.responseURL}return this._responseURL},set:function(t){if(this.rxhr){this.rxhr.responseURL=t;return}this._responseURL=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"upload",{get:function(){if(this.rxhr){return this.rxhr.upload}return this._upload},set:function(t){if(this.rxhr){this.rxhr.upload=t;return}this._upload=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"readyState",{get:function(){if(this.rxhr){return this.rxhr.readyState}return this._readyState},set:function(t){if(this.rxhr){this.rxhr.readyState=t;return}this._readyState=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"onreadystatechange",{get:function(){if(this.rxhr){return this.rxhr.onreadystatechange}return this._onreadystatechange},set:function(t){if(this.rxhr){this.rxhr.onreadystatechange=t;return}this._onreadystatechange=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"timeout",{get:function(){if(this.rxhr){return this.rxhr.timeout}return this._timeout},set:function(t){if(this.rxhr){this.rxhr.timeout=t;return}if(t!==0&&this.isSynchronous){throw new Q("Timeouts cannot be set for synchronous requests made from a document.")}this._timeout=t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"response",{get:function(){if(this.rxhr){return this.rxhr.response}if(this.responseType===""||this.responseType==="text"){if(this.readyState!==this.LOADING&&this.readyState!==this.DONE){return""}return this.responseText}if(this.readyState!==this.DONE){return null}var t=this.res.body();if(!t){return null}if(this.responseType==="json"&&typeof t==="string"){try{return JSON.parse(this.responseText)}catch(t){return null}}if(this.responseType==="blob"&&typeof t==="string"){try{throw ot}catch(t){return null}}if(this.responseType==="arraybuffer"&&typeof t==="string"){try{throw ot}catch(t){return null}}if(this.responseType==="document"&&typeof t==="string"){try{throw ot}catch(t){return null}}return t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"responseText",{get:function(){if(this.rxhr){return this.rxhr.responseText}return this.res.body()||""},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"responseXML",{get:function(){if(this.rxhr){return this.rxhr.responseXML}throw ot},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"status",{get:function(){if(this.rxhr){return this.rxhr.status}return this.res.status()},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"statusText",{get:function(){if(this.rxhr){return this.rxhr.statusText}return this.res.reason()},enumerable:true,configurable:true});r.prototype.getAllResponseHeaders=function(){if(this.rxhr){return this.rxhr.getAllResponseHeaders()}var t=this.res.headers();var e=Object.keys(t).map(function(e){return e+": "+t[e]+"\r\n"}).join("");return e};r.prototype.getResponseHeader=function(t){if(this.rxhr){return this.rxhr.getResponseHeader(t)}if(this.readyState<r.HEADERS_RECEIVED){return null}return this.res.header(t)};r.prototype.setRequestHeader=function(t,e){if(this.rxhr){return this.rxhr.setRequestHeader(t,e)}if(this.readyState<r.OPENED){throw new Q("xhr must be OPENED.")}this.req.header(t,e)};r.prototype.overrideMimeType=function(t){throw ot};r.prototype.open=function(t,e,n,s,o){var i=this;if(n===void 0){n=true}if(s===void 0){s=null}if(o===void 0){o=null}if(it.indexOf(t)!==-1){throw new Q("Method "+t+" is forbidden.")}t=t.toUpperCase();var h=X(e);h.username=s||"";h.password=s&&o||"";if(!n&&(this._timeout!==0||this.responseType!=="")){throw new Q("InvalidAccessError")}if(this.isSending){throw new Q("Unable to terminate the previous request")}this.isSending=false;this.isSynchronous=!n;this.req.method(t).headers({}).url(G(h));var a=r.handlers.find(function(t){return t.match(i.req)});if(!a){var u=window["RealXMLHttpRequest"];var f=new u;var l=this,p=l.onabort,c=l.onerror,d=l.onload,y=l.onloadend,m=l.onloadstart,v=l.onprogress,b=l.onreadystatechange,g=l.ontimeout,E=l.responseType,w=l.timeout,x=l.withCredentials;Object.assign(f,{onabort:p,onerror:c,onload:d,onloadend:y,onloadstart:m,onprogress:v,onreadystatechange:b,ontimeout:g,responseType:E,timeout:w,withCredentials:x});var O=this.req.headers();Object.keys(O||{}).forEach(function(t){f.setRequestHeader(t,O[t])});this.rxhr=f;return f.open(t,e,n,s,o)}this.applyNetworkError();if(this.readyState!==this.OPENED){this.readyState=r.OPENED;this.dispatchEvent(new K("readystatechange"))}};r.prototype.sendSync=function(){var t;try{t=tt(r.handlers,this.req,this.res);this.handleResponseBody(t);console.log&&console.log("%c<<< XHR MOCK HTTP","color: #339900;text-decoration: underline;",this.req.method()+" "+this.req.url()+" RESPONSE BODY : "+JSON.stringify(t),"REQUEST BODY : ",JSON.stringify(this.req.body()))}catch(t){r.errorCallback({req:this.req,err:t});this.handleError(t)}};r.prototype.sendAsync=function(){return i(this,void 0,void 0,function(){var t=this;var e,n,s,i,a;return h(this,function(h){switch(h.label){case 0:e=this.req;n=at(this.res);this.dispatchEvent(new J("loadstart",o({},n,{loaded:0})));if(!this.isUploadComplete){s=at(this.req);this.upload.dispatchEvent(new J("loadstart",o({},s,{loaded:0})))}if(this.readyState!==this.OPENED||!this.isSending){return[2]}if(this._timeout!==0){this._timeoutTimer=setTimeout(function(){t.isTimedOut=true;t.handleError()},this._timeout)}h.label=1;case 1:h.trys.push([1,3,,4]);return[4,et(r.handlers,this.req,this.res)];case 2:i=h.sent();clearTimeout(this._timeoutTimer);if(this.isAborted||this.isTimedOut){return[2]}this.sendRequest(e);this.receiveResponse(i);console.log&&console.log("%c<<< XHR MOCK HTTP","color: #339900;text-decoration: underline;",this.req.method()+" "+this.req.url()+" RESPONSE BODY : "+JSON.stringify(i),"REQUEST BODY : ",JSON.stringify(this.req.body()));return[3,4];case 3:a=h.sent();clearTimeout(this._timeoutTimer);if(this.isAborted||this.isTimedOut){return[2]}r.errorCallback({req:this.req,err:a});this.handleError(a);return[3,4];case 4:return[2]}})})};r.prototype.applyNetworkError=function(){this.res.status(0).reason("").headers({}).body(null)};r.prototype.reportError=function(t){this.readyState=this.DONE;this.isSending=false;this.applyNetworkError();if(this.isSynchronous){throw new Q("An error occurred whilst sending a synchronous request.")}this.dispatchEvent(new K("readystatechange"));if(!this.isUploadComplete){this.isUploadComplete=true;var e=at(this.req);this.upload.dispatchEvent(new J(t,e));this.upload.dispatchEvent(new J("loadend",e))}var r=at(this.res);this.dispatchEvent(new J(t,r));this.dispatchEvent(new J("loadend",r))};r.prototype.sendRequest=function(t){if(this.isUploadComplete){return}this.isUploadComplete=true;var e=at(this.req);this.upload.dispatchEvent(new J("progress",e));this.upload.dispatchEvent(new J("load",e));this.upload.dispatchEvent(new J("loadend",e))};r.prototype.receiveResponse=function(t){this.readyState=this.HEADERS_RECEIVED;this.dispatchEvent(new K("readystatechange"));if(t.body()===null){this.handleResponseBody(t);return}this.readyState=this.LOADING;this.dispatchEvent(new K("readystatechange"));this.handleResponseBody(t)};r.prototype.handleError=function(t){if(!this.isSending){return}if(this.isTimedOut){this.reportError("timeout");return}if(this.isAborted){this.reportError("abort");return}this.reportError("error")};r.prototype.handleResponseBody=function(t){this.res=t;var e=at(t);if(!this.isSynchronous){this.dispatchEvent(new J("progress",e))}this.readyState=this.DONE;this.isSending=false;this.dispatchEvent(new K("readystatechange"));this.dispatchEvent(new J("load",e));this.dispatchEvent(new J("loadend",e))};r.prototype.send=function(t){if(this.rxhr){return this.rxhr.send(t)}console.log&&console.log("%c>>> XHR MOCK HTTP","color: #339900;text-decoration: underline;",this.req.method()+" "+this.req.url()+" HEADERS : "+JSON.stringify(this.req.headers())+" BODY : "+t);if(this.readyState!==r.OPENED){throw new Q("Please call MockXMLHttpRequest.open() before MockXMLHttpRequest.send().")}if(this.isSending){throw new Q("MockXMLHttpRequest.send() has already been called.")}if(this.req.method()==="GET"||this.req.method()==="HEAD"){t=null}var e;var n;if(t!==null&&t!==undefined){if(typeof Document!=="undefined"&&typeof XMLDocument!=="undefined"&&t instanceof Document){e="UTF-8";n=t instanceof XMLDocument?"application/xml":"text/html"}else{if(typeof Blob!=="undefined"&&t instanceof Blob){n=t.type}else if(typeof FormData!=="undefined"&&t instanceof FormData){n="multipart/form-data; boundary=----XHRMockFormBoundary"}else if(typeof URLSearchParams!=="undefined"&&t instanceof URLSearchParams){e="UTF-8";n="application/x-www-form-urlencoded"}else if(typeof t==="string"){e="UTF-8";n="text/plain"}else{throw ot}}var s=this.req.header("content-type");if(!s){this.req.header("content-type",e?n+"; charset="+e:n)}this.req.body(t)}this.isUploadComplete=false;this.isTimedOut=false;if(t===null||t===undefined){this.isUploadComplete=true}this.isSending=true;if(this.isSynchronous){this.sendSync()}else{this.sendAsync()}};r.prototype.abort=function(){if(this.rxhr){return this.rxhr.abort()}clearTimeout(this._timeoutTimer);this.isAborted=true;if(this.readyState===this.OPENED||this.readyState===this.HEADERS_RECEIVED||this.readyState===this.LOADING){this.reportError("abort")}if(this.readyState===this.DONE){this.readyState=this.UNSENT;this.applyNetworkError();return}};r.prototype.msCachingEnabled=function(){return false};r.UNSENT=ht.UNSENT;r.OPENED=ht.OPENED;r.HEADERS_RECEIVED=ht.HEADERS_RECEIVED;r.LOADING=ht.LOADING;r.DONE=ht.DONE;r.handlers=[];r.errorCallback=function(t){var e=t.req,r=t.err;if(r instanceof Q){console.error(st(r.message,e))}else{console.error(st("A handler returned an error for the request.",e,r))}};return r}($);var ft=window["RealXMLHttpRequest"]=window.XMLHttpRequest;var lt=function(){function t(){this.RealXMLHttpRequest=ft}t.prototype.setup=function(){window.XMLHttpRequest=ut;this.reset();return this};t.prototype.teardown=function(){this.reset();window.XMLHttpRequest=ft;return this};t.prototype.reset=function(){ut.removeAllHandlers();return this};t.prototype.error=function(t){ut.errorCallback=t;return this};t.prototype.mock=function(t,e,r){console.warn("xhr-mock: XHRMock.mock() has been deprecated. Use XHRMock.use() instead.");if(typeof t==="string"&&(typeof e==="string"||e instanceof RegExp)&&r!==undefined){return this.use(t,e,r)}else if(typeof t==="function"){return this.use(t)}else{throw new Error("xhr-mock: Invalid handler.")}};t.prototype.use=function(t,e,n){var s;if(typeof t==="string"&&(typeof e==="string"||e instanceof RegExp)&&n!==undefined){s=r(t,e,n)}else if(typeof t==="function"){s=t}else{throw new Error("xhr-mock: Invalid handler.")}ut.addHandler(s);return this};t.prototype.get=function(t,e){return this.use("GET",t,e)};t.prototype.post=function(t,e){return this.use("POST",t,e)};t.prototype.put=function(t,e){return this.use("PUT",t,e)};t.prototype.patch=function(t,e){return this.use("PATCH",t,e)};t.prototype["delete"]=function(t,e){return this.use("DELETE",t,e)};return t}();var pt=new lt;return pt});