<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta content="width=device-width,height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1" name="viewport">
	</head>
	<body>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<style>#M408599ScriptRootC340981 {min-height: 300px;}
		</style>
1

<button id="page1">page1</button>
<button id="page2">page2</button>
<!-- Composite Start -->
<div class="main1">page1 body</div>
<div class="main2" >
	<div id="M408599ScriptRootC340981">
		<div id="M408599PreloadC340981">
        Loading...    </div>
        <script>

    </script>
    </div>
	</div>
        
2
<script type="text/javascript">

var hiddenProperty = 'hidden' in document ? 'hidden' :    
    'webkitHidden' in document ? 'webkitHidden' :    
    'mozHidden' in document ? 'mozHidden' :    
    null;
var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
var onVisibilityChange = function(){
    if (!document[hiddenProperty]) {    
        console.log('页面非激活');
    }else{
        console.log('页面激活')
//    	if($("#addScript").length==0){
//	        console.log('页面激活');
//	        loadScriptString("(function(){var D=new Date(),d=document,b='body',ce='createElement',ac='appendChild',st='style',ds='display',n='none',gi='getElementById',lp=d.location.protocol,wp=lp.indexOf('http')==0?lp:'https:';var i=d[ce]('iframe');i[st][ds]=n;d[gi]('M408599ScriptRootC340981')[ac](i);try{var iw=i.contentWindow.document;iw.open();iw.writeln('<ht'+'ml><bo'+'dy></bo'+'dy></ht'+'ml>');iw.close();var c=iw[b];}catch(e){var iw=d;var c=d[gi]('M408599ScriptRootC340981');}var dv=iw[ce]('div');dv.id='MG_ID';dv[st][ds]=n;dv.innerHTML=340981;c[ac](dv);var s=iw[ce]('script');s.async='async';s.defer='defer';s.charset='utf-8';s.src=wp+'//jsc.mgid.com/m/g/m.gameg.net.340981.js?t='+D.getYear()+D.getMonth()+D.getUTCDate()+D.getUTCHours();c[ac](s);})();")
//      }
    }
}
document.addEventListener(visibilityChangeEvent, onVisibilityChange);


window.onfocus = function() {
console.log("页面获取了焦点");
	if($("#addScript").length==0){
	    console.log('页面激活1');
        loadScriptString("(function(){var D=new Date(),d=document,b='body',ce='createElement',ac='appendChild',st='style',ds='display',n='none',gi='getElementById',lp=d.location.protocol,wp=lp.indexOf('http')==0?lp:'https:';var i=d[ce]('iframe');i[st][ds]=n;d[gi]('M408599ScriptRootC340981')[ac](i);try{var iw=i.contentWindow.document;iw.open();iw.writeln('<ht'+'ml><bo'+'dy></bo'+'dy></ht'+'ml>');iw.close();var c=iw[b];}catch(e){var iw=d;var c=d[gi]('M408599ScriptRootC340981');}var dv=iw[ce]('div');dv.id='MG_ID';dv[st][ds]=n;dv.innerHTML=340981;c[ac](dv);var s=iw[ce]('script');s.async='async';s.defer='defer';s.charset='utf-8';s.src=wp+'//jsc.mgid.com/m/g/m.gameg.net.340981.js?t='+D.getYear()+D.getMonth()+D.getUTCDate()+D.getUTCHours();c[ac](s);})();")
    }
};

//window.onfocus=function(){
//	console.log("111")
//}

	
	
	function loadScriptString(code){
		var script=document.createElement("script");
		script.type="text/javascript";
		script.id="addScript";
		try{
			script.appendChild(document.createTextNode(code));
		}catch(ex){
			script.text=code;
		}
		document.body.appendChild(script);
	}
	
</script>
	</body>
</html>
