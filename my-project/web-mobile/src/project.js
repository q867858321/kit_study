window.__require=function t(o,e,s){function c(n,a){if(!e[n]){if(!o[n]){var r=n.split("/");if(r=r[r.length-1],!o[r]){var l="function"==typeof __require&&__require;if(!a&&l)return l(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+n+"'")}}var h=e[n]={exports:{}};o[n][0].call(h.exports,function(t){return c(o[n][1][t]||t)},h,h.exports,t,o,e,s)}return e[n].exports}for(var i="function"==typeof __require&&__require,n=0;n<s.length;n++)c(s[n]);return c}({block:[function(t,o,e){"use strict";cc._RF.push(o,"b6c808XNx1MoZuqsTry0QDM","block");var s=function(t){return t&&t.__esModule?t:{default:t}}(t("colors"));cc.Class({extends:cc.Component,properties:{numLabel:cc.Label,isCompound:!1},start:function(){},setNumber:function(t){0==t&&(this.numLabel.node.active=!1),this.numLabel.string=t,t in s.default&&(this.node.color=s.default[t])}}),cc._RF.pop()},{colors:"colors"}],colors:[function(t,o,e){"use strict";cc._RF.push(o,"979a3n+OAhBRI0bP0PyxLGb","colors");var s=[];s[0]=cc.color(198,184,172,255),s[2]=cc.color(235,224,213,255),s[4]=cc.color(234,219,193,255),s[8]=cc.color(240,167,110,255),s[16]=cc.color(244,138,89,255),s[32]=cc.color(245,112,85,255),s[64]=cc.color(245,83,52,255),s[128]=cc.color(234,200,103,255),s[256]=cc.color(234,197,87,255),s[512]=cc.color(234,192,71,255),s[1024]=cc.color(146,208,80,255),s[2048]=cc.color(0,176,240,255),o.exports=s,cc._RF.pop()},{}],game:[function(t,o,e){"use strict";cc._RF.push(o,"ae6d4O5dXFHs7EouAgCg973","game");var s=[2,4];cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,score:0,blockPrefab:cc.Prefab,gap:20,bg:cc.Node,gameOverSence:cc.Node,retryButton:cc.Button,gameOverScoreLabel:cc.Label,checkSuccess:!0,gameSuccessSence:cc.Node,gameSuccessRetryButton:cc.Button,gameSuccessContinueButton:cc.Button,gameSuccessScoreLabel:cc.Label,highestScoreLabel:cc.Label,isAniming:!1},requestAds:function(t){var o=this.getParentUrl();window.top.postMessage("invoke@@@GameModel.Game.requestAds#"+t,o)},getParentUrl:function(){var t=null;if(parent!==window)try{t=parent.location.href}catch(o){t=document.referrer}return t},onKeyDown:function(t){switch(t.keyCode){case cc.macro.KEY.up:this.move(0);break;case cc.macro.KEY.down:this.move(1);break;case cc.macro.KEY.left:this.move(2);break;case cc.macro.KEY.right:this.move(3)}},start:function(){cc.debug.setDisplayStats(!1);var t=this;this.drawBgBlocks(),this.init(),this.addEventHandler(),window.addEventListener("message",function(o){o.data.status,o.data.extra;t.init()},!1)},addEventHandler:function(){var t=this;this.bg.on("touchstart",function(o){t.startPoint=o.getLocation()}),this.bg.on("touchend",function(o){t.touchEnd(o)}),this.bg.on("touchcancel",function(o){t.touchEnd(o)}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(o){t.isAniming||t.onKeyDown(o)},this),this.retryButton.node.on("click",function(o){t.requestAds("fail_retry")}),this.gameSuccessRetryButton.node.on("click",function(o){t.requestAds("success_retry")}),this.gameSuccessContinueButton.node.on("click",function(o){t.gameSuccessSence.active=!1,t.checkSuccess=!1})},touchEnd:function(t){this.endPoint=t.getLocation();var o=this.endPoint.sub(this.startPoint);o.mag()>50&&(Math.abs(o.x)>Math.abs(o.y)?o.x>0?this.move(3):this.move(2):o.y>0?this.move(0):this.move(1))},afterMove:function(t){t&&(this.updateScore(this.score+10),this.addBlock()),this.updateHighestScore(),this.checkIsSuccess()&&this.gameSuccess(),this.checkFail()&&this.gameOver()},checkIsSuccess:function(){for(var t=0;t<4;t++)for(var o=0;o<4;o++){var e=this.data[t][o];if(this.checkSuccess&&e>=2048)return this.checkSuccess=!1,!0}return!1},checkFail:function(){for(var t=0;t<4;t++)for(var o=0;o<4;o++){var e=this.data[t][o];if(0==e)return!1;if(o>0&&this.data[t][o-1]==e)return!1;if(o<3&&this.data[t][o+1]==e)return!1;if(t>0&&this.data[t-1][o]==e)return!1;if(t<3&&this.data[t+1][o]==e)return!1}return!0},gameSuccess:function(){this.gameSuccessSence.active=!0,this.gameSuccessScoreLabel.string="\u5206\u6570\uff1a"+this.score},gameOver:function(){this.gameOverSence.active=!0,this.gameOverScoreLabel.string="\u5206\u6570:"+this.score},doMove:function(t,o,e){var s=this;this.isAniming=!0;var c=cc.moveTo(.05,o),i=cc.callFunc(function(){s.isAniming=!1,e&&e()});t.runAction(cc.sequence(c,i))},move:function(t){var o=this,e=!1,s=function s(c,i,n){var a=void 0,r=void 0,l=void 0;if(0==t?(a=3,c+1<4&&(r=o.data[c+1][i],l=o.poisitions[c+1][i])):1==t?(a=0,c-1>=0&&(r=o.data[c-1][i],l=o.poisitions[c-1][i])):2==t?(a=0,i-1>=0&&(r=o.data[c][i-1],l=o.poisitions[c][i-1])):(a=3,i+1<4&&(r=o.data[c][i+1],l=o.poisitions[c][i+1])),(2!=t&&3!=t||i!=a)&&(0!=t&&1!=t||c!=a)&&0!=o.data[c][i])if(0==r){var h=o.blocks[c][i];0==t?(o.blocks[c+1][i]=h,o.data[c+1][i]=o.data[c][i],o.data[c][i]=0,o.blocks[c][i]=null,o.doMove(h,l,function(){s(c+1,i,n)})):1==t?(o.blocks[c-1][i]=h,o.data[c-1][i]=o.data[c][i],o.data[c][i]=0,o.blocks[c][i]=null,o.doMove(h,l,function(){s(c-1,i,n)})):2==t?(o.blocks[c][i-1]=h,o.data[c][i-1]=o.data[c][i],o.data[c][i]=0,o.blocks[c][i]=null,o.doMove(h,l,function(){s(c,i-1,n)})):(o.blocks[c][i+1]=h,o.data[c][i+1]=o.data[c][i],o.data[c][i]=0,o.blocks[c][i]=null,o.doMove(h,l,function(){s(c,i+1,n)})),e=!0}else{if(r!=o.data[c][i])return void(n&&n());var u=o.blocks[c][i];if(0==t){if(o.blocks[c+1][i].isCompound)return void(n&&n());o.data[c+1][i]=2*r,o.data[c][i]=0,o.blocks[c][i]=null,o.blocks[c+1][i].getComponent("block").setNumber(o.data[c+1][i]),o.blocks[c+1][i].isCompound=!0,o.doMove(u,l,function(){u.destroy(),n&&n()})}else if(1==t){if(o.blocks[c-1][i].isCompound)return void(n&&n());o.data[c-1][i]=2*r,o.data[c][i]=0,o.blocks[c][i]=null,o.blocks[c-1][i].getComponent("block").setNumber(o.data[c-1][i]),o.blocks[c-1][i].isCompound=!0,o.doMove(u,l,function(){u.destroy(),n&&n()})}else if(2==t){if(o.blocks[c][i-1].isCompound)return void(n&&n());o.data[c][i-1]=2*r,o.data[c][i]=0,o.blocks[c][i]=null,o.blocks[c][i-1].getComponent("block").setNumber(o.data[c][i-1]),o.blocks[c][i-1].isCompound=!0,o.doMove(u,l,function(){u.destroy(),n&&n()})}else{if(o.blocks[c][i+1].isCompound)return void(n&&n());o.data[c][i+1]=2*r,o.data[c][i]=0,o.blocks[c][i]=null,o.blocks[c][i+1].getComponent("block").setNumber(o.data[c][i+1]),o.blocks[c][i+1].isCompound=!0,o.doMove(u,l,function(){u.destroy(),n&&n()})}e=!0}else n&&n()},c=[];if(0==t)for(var i=3;i>=0;i--)for(var n=0;n<4;n++)null!=this.blocks[i][n]&&(this.blocks[i][n].isCompound=!1),0!=this.data[i][n]&&c.push({x:i,y:n});else if(1==t)for(var a=0;a<4;a++)for(var r=0;r<4;r++)null!=this.blocks[a][r]&&(this.blocks[a][r].isCompound=!1),0!=this.data[a][r]&&c.push({x:a,y:r});else if(2==t)for(var l=0;l<4;l++)for(var h=0;h<4;h++)null!=this.blocks[l][h]&&(this.blocks[l][h].isCompound=!1),0!=this.data[l][h]&&c.push({x:l,y:h});else for(var u=0;u<4;u++)for(var d=3;d>=0;d--)null!=this.blocks[u][d]&&(this.blocks[u][d].isCompound=!1),0!=this.data[u][d]&&c.push({x:u,y:d});for(var f=0,b=0;b<c.length;b++)s(c[b].x,c[b].y,function(){++f==c.length&&o.afterMove(e)})},init:function(){if(this.updateHighestScore(),this.gameOverSence.active=!1,this.gameSuccessSence.active=!1,this.checkSuccess=!0,this.updateScore(0),this.blocks)for(var t=0;t<this.blocks.length;t++)for(var o=0;o<this.blocks[t].length;o++)null!=this.blocks[t][o]&&this.blocks[t][o].destroy();this.data=[],this.blocks=[];for(var e=0;e<4;e++)this.blocks.push([null,null,null,null]),this.data.push([0,0,0,0]);this.addBlock(),this.addBlock(),this.addBlock()},updateHighestScore:function(){var t=cc.sys.localStorage.getItem("highest_score");null==t?null!=this.score?(cc.sys.localStorage.setItem("highest_score",this.score),this.highestScoreLabel.string="\u6700\u9ad8\uff1a"+this.score):this.highestScoreLabel.string="\u6700\u9ad8\uff1a0":null!=this.score&&t<this.score?(cc.sys.localStorage.setItem("highest_score",this.score),this.highestScoreLabel.string="\u6700\u9ad8\uff1a"+this.score):this.highestScoreLabel.string="\u6700\u9ad8\uff1a"+t},addBlock:function(){var t=this.getEmptyLocations();if(0==t.length)return!1;var o=t[Math.floor(Math.random()*t.length)],e=o.x,c=o.y,i=this.poisitions[e][c],n=cc.instantiate(this.blockPrefab);n.width=this.blockSize,n.height=this.blockSize,this.bg.addChild(n),n.setPosition(i);var a=s[Math.floor(Math.random()*s.length)];return n.getComponent("block").setNumber(a),this.blocks[e][c]=n,this.data[e][c]=a,!0},getEmptyLocations:function(){for(var t=[],o=0;o<this.blocks.length;o++)for(var e=0;e<this.blocks[o].length;e++)null==this.blocks[o][e]&&t.push({x:o,y:e});return t},updateScore:function(t){this.score=t,this.scoreLabel.string="\u5206\u6570:"+t},onDestroy:function(){var t=this;cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,function(o){t.onKeyDown()},this)},drawBgBlocks:function(){this.blockSize=(cc.winSize.width-5*this.gap)/4;var t=this.gap+this.blockSize/2,o=this.blockSize;this.poisitions=[];for(var e=0;e<4;++e){this.poisitions.push([0,0,0,0]);for(var s=0;s<4;++s){var c=cc.instantiate(this.blockPrefab);c.width=this.blockSize,c.height=this.blockSize,this.bg.addChild(c),c.setPosition(cc.v2(t,o)),this.poisitions[e][s]=cc.v2(t,o),t+=this.gap+this.blockSize,c.getComponent("block").setNumber(0)}o+=this.gap+this.blockSize,t=this.gap+this.blockSize/2}}}),cc._RF.pop()},{}]},{},["block","colors","game"]);